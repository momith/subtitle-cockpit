<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Explorer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="navbar-container">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a href="{{ url_for('index') }}" class="nav-link active">
                        <i class="fas fa-folder-open"></i> File Explorer
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('jobs_page') }}" class="nav-link">
                        <i class="fas fa-tasks"></i> Job Queue
                    </a>
                </li>
                <li class="nav-item">
                    <a href="{{ url_for('settings_page') }}" class="nav-link">
                        <i class="fas fa-cog"></i> Settings
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Toast notification container -->
    <div id="toastContainer" class="toast-container"></div>
    
    <div class="container">
        <div class="header">
            <div class="breadcrumb" id="breadcrumb"></div>
        </div>
        
        <div class="toolbar">
            <button id="refreshBtn" class="btn">
                <i class="fas fa-rotate"></i> Refresh
            </button>
            <button id="newFolderBtn" class="btn">
                <i class="fas fa-folder-plus"></i> New Folder
            </button>
            <button id="renameBtn" class="btn" disabled>
                <i class="fas fa-edit"></i> Rename/Move
            </button>
            <button id="bulkEditBtn" class="btn" disabled>
                <i class="fas fa-i-cursor"></i> Bulk Edit
            </button>
            <button id="deleteBtn" class="btn" disabled>
                <i class="fas fa-trash"></i> Delete
            </button>
            <button id="deleteFolderBtn" class="btn" disabled>
                <i class="fas fa-folder-minus"></i> Delete Folder
            </button>
            <button id="downloadBtn" class="btn" disabled>
                <i class="fas fa-download"></i> Download
            </button>
            <button id="uploadBtn" class="btn">
                <i class="fas fa-upload"></i> Upload
            </button>
            <input type="file" id="uploadFileInput" multiple style="display: none;" />
        </div>

        <div id="uploadProgress" class="upload-progress-container" style="display: none;">
            <div id="uploadProgressLabel" class="upload-progress-label"></div>
            <div class="upload-progress-bar-outer">
                <div id="uploadProgressBar" class="upload-progress-bar-inner"></div>
            </div>
            <div id="uploadProgressText" class="upload-progress-text">0%</div>
        </div>
        <div class="toolbar" style="margin-top:6px;">
            <button id="extractBtn" class="btn" disabled>
                <i class="fas fa-file-export"></i> Extract SUP/SUB/SRT
            </button>
            <button id="supToSrtBtn" class="btn" disabled>
                <i class="fas fa-exchange-alt"></i> SUP/SUB to SRT
            </button>
            <button id="translateBtn" class="btn" disabled>
                <i class="fas fa-language"></i> Translate SRT
            </button>
            <button id="searchSubtitlesBtn" class="btn" disabled>
                <i class="fas fa-search"></i> Search SRT
            </button>
            <button id="syncSubtitlesBtn" class="btn" disabled>
                <i class="fas fa-sync-alt"></i> Sync SRT
            </button>
            <button id="publishSubtitlesBtn" class="btn" disabled>
                <i class="fas fa-cloud-upload-alt"></i> Publish SRT
            </button>
        </div>
        
        <div class="filter-toolbar" style="margin-top:12px; display:flex; gap:8px; align-items:center;">
            <span style="font-weight:500; color:#666;">Filter:</span>
            <button id="filterAllBtn" class="btn btn-filter active">All</button>
            <button id="filterVideoBtn" class="btn btn-filter"><i class="fas fa-film"></i> Videos</button>
            <button id="filterSubtitleBtn" class="btn btn-filter"><i class="fas fa-closed-captioning"></i> Subtitles</button>
        </div>
        
        <div class="file-list">
            <div class="file-list-header">
                <div class="file-list-name">
                    <input type="checkbox" id="selectAll" title="Select all files in this folder">
                    Name
                </div>
                <div class="file-list-size">Size</div>
            </div>
            <div id="fileList" class="file-list-content">
                <!-- Files and folders will be loaded here -->
            </div>
        </div>
    </div>

    <!-- Bulk Rename Modal -->
    <div id="bulkRenameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-i-cursor"></i> Bulk Edit (Find & Replace)</h3>
                <button class="modal-close" id="bulkRenameModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: #666;">
                    Renames all selected files by applying Find/Replace to the filename (the folder/path is not changed).
                </p>

                <div style="display:flex; gap:10px;">
                    <div style="flex:1;">
                        <label for="bulkRenameFind" style="display: block; font-weight: 600; margin-bottom: 8px;">Find</label>
                        <input type="text" id="bulkRenameFind" style="width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 6px;" placeholder="e.g. Attack.On.Titan" />
                    </div>
                    <div style="flex:1;">
                        <label for="bulkRenameReplace" style="display: block; font-weight: 600; margin-bottom: 8px;">Replace</label>
                        <input type="text" id="bulkRenameReplace" style="width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 6px;" placeholder="e.g. Attack.On.Titan.German" />
                    </div>
                </div>

                <div style="margin-top: 12px;">
                    <label style="display: block; font-weight: 600; margin-bottom: 8px;">Preview</label>
                    <div id="bulkRenamePreview" style="border:1px solid #e1e4e8; border-radius:6px; padding:8px; max-height:200px; overflow:auto; font-family: monospace; font-size: 13px; background:#fff;"></div>
                </div>

                <div id="bulkRenameError" style="display: none; margin-top: 8px; padding: 8px; background: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;"></div>
            </div>
            <div class="modal-footer">
                <button id="bulkRenameConfirmBtn" class="btn"><i class="fas fa-check"></i> Apply</button>
                <button id="bulkRenameCancelBtn" class="btn"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <!-- New Folder Modal -->
    <div id="mkdirModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-folder-plus"></i> New Folder</h3>
                <button class="modal-close" id="mkdirModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: #666;">
                    Create a new directory in the current folder.
                </p>
                <label for="mkdirNameInput" style="display: block; font-weight: 600; margin-bottom: 8px;">Folder name</label>
                <input type="text" id="mkdirNameInput" style="width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 6px;" placeholder="e.g. Season 03" />
                <div id="mkdirError" style="display: none; margin-top: 8px; padding: 8px; background: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;"></div>
            </div>
            <div class="modal-footer">
                <button id="mkdirConfirmBtn" class="btn"><i class="fas fa-check"></i> Create</button>
                <button id="mkdirCancelBtn" class="btn"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <!-- Publish Subtitle Modal -->
    <div id="publishModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cloud-upload-alt"></i> Publish Subtitle</h3>
                <button class="modal-close" id="publishModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 12px; color: #666;">
                    Select the movie/series and provide an identifier (TMDB recommended). Publishing will try all enabled providers that support uploads.
                </div>

                <label for="imdbSearchInput" style="display: block; font-weight: 600; margin-bottom: 8px;">Search IMDb</label>
                <input type="text" id="imdbSearchInput" placeholder="Type at least 2 characters..." style="width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 6px;">
                <div id="imdbSearchResults" style="display:none; border:1px solid #e1e4e8; border-radius:6px; margin-top:6px; max-height:220px; overflow:auto; background:#fff;"></div>

                <div class="grid" style="margin-top: 14px; gap: 10px;">
                    <div class="grid grid-2">
                        <div>
                            <label for="publishTypeSelect">Type</label>
                            <select id="publishTypeSelect">
                                <option value="movie">Movie</option>
                                <option value="tv">TV</option>
                            </select>
                        </div>
                        <div>
                            <label for="publishTmdbId">TMDB ID</label>
                            <input id="publishTmdbId" type="text" placeholder="e.g. 822119" />
                        </div>
                    </div>
                    <div class="grid grid-2">
                        <div>
                            <label for="publishImdbId">IMDb ID</label>
                            <input id="publishImdbId" type="text" placeholder="e.g. tt1375666" />
                        </div>
                        <div>
                            <label for="publishTitle">Title</label>
                            <input id="publishTitle" type="text" placeholder="Title" />
                        </div>
                    </div>

                    <div>
                        <label for="publishComment">Comment</label>
                        <textarea id="publishComment" rows="3" style="width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 6px; resize: vertical;" placeholder="Optional comment shown on the provider"></textarea>
                    </div>
                    <div id="publishError" style="display:none; margin-top: 8px; padding: 8px; background: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="publishConfirmBtn" class="btn"><i class="fas fa-check"></i> Publish</button>
                <button id="publishCancelBtn" class="btn"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <!-- Rename/Move Modal -->
    <div id="renameModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-edit"></i> Rename/Move File or Folder</h3>
                <button class="modal-close" id="renameModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <p style="margin-bottom: 12px; color: #666;">
                    Edit the path to rename or move the item to a different location. For folders, all content will be moved.
                </p>
                <label for="renameInput" style="display: block; font-weight: 600; margin-bottom: 8px;">
                    Full Path:
                </label>
                <input type="text" id="renameInput" style="width: 100%; padding: 8px; border: 1px solid #e1e4e8; border-radius: 6px; font-family: monospace; font-size: 13px;">
                <div id="renameError" style="display: none; margin-top: 8px; padding: 8px; background: #fee; border: 1px solid #fcc; border-radius: 4px; color: #c33;">
                </div>
            </div>
            <div class="modal-footer">
                <button id="renameConfirmBtn" class="btn"><i class="fas fa-check"></i> Confirm</button>
                <button id="renameCancelBtn" class="btn"><i class="fas fa-times"></i> Cancel</button>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>
